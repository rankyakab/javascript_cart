<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <h1>shopping cart</h1>
	<div>
		<ul>
			<li><a class="add_to_cart" href="" data-name="apple" data-price="33.00" > Apple | $33.00 </a></li>
			<li><a class="add_to_cart" href="" data-name="mango" data-price="34.30" > Mango | $34.30 </a></li>
			<li><a  class="add_to_cart" href="" data-name="orange" data-price="38.52" > orange | $38.52 </a></li>
			<li><a  class="add_to_cart" href="" data-name="paw paw" data-price="43.20" > paw paw | $43.20 </a></li>
		</ul>
		<button id="clear_cart"> clear cart </button>
	</div>
	<div>
		
		<ul id="show_cart">
			??????
		</ul>
		<div >
		Total Cart:$ <span id="total_count"></span>
		</div>
	</div>
  </body>
  <script type="text/javascript">
   var Cart = [];
  loadCart()
  display_cart();
  var add_to_cart = document.getElementsByClassName("add_to_cart");
  var clear_cart = document.getElementById("clear_cart");
  var delete_item = document.getElementsByClassName("delete_item");
  for(let i in Array.from(add_to_cart)){
  add_to_cart[i].addEventListener("click",(event)=>{
	event.preventDefault();
	var name = event.target.getAttribute("data-name");
	var price = Number(event.target.getAttribute("data-price"));
	console.log(name, price)
	addItemToCart(name,price,1);
	display_cart();
  });
  }
  
   for(let i in Array.from(delete_item)){
		  delete_item[i].addEventListener("click",(event)=>{
			event.preventDefault();
			var name = event.target.parentNode.getAttribute("data-name");
			removeItemFromCartAll(name)
			display_cart();
			
		  }, true);
		  }
   
  
  clear_cart.addEventListener("click",event=>{
	clearCart();
	display_cart();
  })

  function display_cart(){
        
		var display_section = document.getElementById("show_cart");
		var display = "";
		var cartArray = listCart();
		for(let i in cartArray){
			display+="<li data-name='"+cartArray[i].name+"'> Name : "+cartArray[i].name+" || price "+cartArray[i].price+" || Count : "+cartArray[i].count+" || TOTAL "+cartArray[i].total+" <button class='delete_item'>X</button></li>";
		}
		display_section.innerHTML=display;
		document.getElementById("total_count").innerHTML=totalCount();
		
  }
     
      var Item = function(name,price,count){
        this.name=name
        this.price=price
        this.count=count
      }

      function addItemToCart(name, price, count){
         for(var item in Cart){
           if(Cart[item].name===name){
             Cart[item].count +=count;
			 saveCart();
             return;
           }
         }
        var item = new Item(name,price,count);
        Cart.push(item);
		saveCart();
      }


  
      // removes one item from charset
      function removeItemFromCart(name){
      for(var item in Cart){
        if(Cart[item].name===name){
          Cart[item].count--;
          if(Cart[item].count===0){
            Cart.splice(item, 1);
          }
          break;
        }

      }
	  saveCart();
    }
 


      //removeItemFromCartAll() removes all item from chart
    function removeItemFromCartAll(name){
      for(var item in Cart){
        if(Cart[item].name===name){
            Cart.splice(item, 1);
            break;
        }

      }
	  
	  saveCart();
    }
      //clearCart ()
      function clearCart(){
        Cart = [];
		saveCart();
      }
    //  clearCart();
      //countCart()  returns total count
      function countCart(){
        var totalCount=0;
        for(let item in Cart){
          totalCount+=Cart[item].count;
        }
        return totalCount
      }
      console.log(countCart());
      //totalCount() returns total cost
      function totalCount(){
        var total=0;
		 loadCart();
        for(let item in Cart){
				total+=Cart[item].price*Cart[item].count;
	        }
        return total.toFixed(2);
      }
     
      //listCart()
      //first partten
      /*
      function listCart(){
        var arrayObject=[];
        for(var i in Cart){
          var newItem = new Item(Cart[i].name,Cart[i].price,Cart[i].count);
          arrayObject.push(newItem);
        }
        return arrayObject;
      }
      */
      //second partern
      function listCart(){
        var arrayObject=[];
        for(var i in Cart){
           var obj = {};
          for(var keys in Cart[i]){
            obj[keys] = Cart[i][keys];
          }
		  obj.total = (obj.count * obj.price).toFixed(2)
          arrayObject.push(obj);
        }
        return arrayObject;
      }
      
      //saveCart()
	  function saveCart(){
		localStorage.setItem("shopping_cart", JSON.stringify(Cart));
	  }
	  localStorage.setItem("bola",4 );
      //loadCart()
	  function loadCart(){
		 Cart = JSON.parse(localStorage.getItem("shopping_cart"));
	  }
	



  </script>
</html>
